package wtf.demise.features.modules.impl.exploit;

import net.minecraft.util.AxisAlignedBB;
import wtf.demise.Demise;
import wtf.demise.events.annotations.EventTarget;
import wtf.demise.events.impl.player.MotionEvent;
import wtf.demise.events.impl.render.Render3DEvent;
import wtf.demise.features.modules.Module;
import wtf.demise.features.modules.ModuleInfo;
import wtf.demise.features.modules.impl.visual.Interface;
import wtf.demise.features.values.impl.BoolValue;
import wtf.demise.utils.packet.LagUtils;
import wtf.demise.utils.render.RenderUtils;

import java.awt.*;

@ModuleInfo(name = "Blink", description = "Holds back packets in order to teleport.")
public class Blink extends Module {
    private final BoolValue showPrevPos = new BoolValue("Show Prev Pos", true, this);
    private double prevX;
    private double prevY;
    private double prevZ;

    @Override
    public void onEnable() {
        if (showPrevPos.get()) {
            prevX = mc.thePlayer.posX;
            prevY = mc.thePlayer.posY;
            prevZ = mc.thePlayer.posZ;
        }
    }

    @EventTarget
    public void onMotion(MotionEvent event) {
        if (event.isPost())
            return;
        LagUtils.blink();
    }

    @EventTarget
    public void onRender3D(Render3DEvent event) {
        double x = prevX - mc.getRenderManager().viewerPosX;
        double y = prevY - mc.getRenderManager().viewerPosY;
        double z = prevZ - mc.getRenderManager().viewerPosZ;
        AxisAlignedBB box = mc.thePlayer.getEntityBoundingBox().expand(0.1D, 0.1, 0.1);
        AxisAlignedBB axis = new AxisAlignedBB(box.minX - mc.thePlayer.posX + x, box.minY - mc.thePlayer.posY + y, box.minZ - mc.thePlayer.posZ + z, box.maxX - mc.thePlayer.posX + x, box.maxY - mc.thePlayer.posY + y, box.maxZ - mc.thePlayer.posZ + z);
        RenderUtils.drawAxisAlignedBB(axis, true, new Color(Demise.INSTANCE.getModuleManager().getModule(Interface.class).color(0)).getRGB());
    }

    @Override
    public void onDisable() {
        LagUtils.dispatch();
    }
}