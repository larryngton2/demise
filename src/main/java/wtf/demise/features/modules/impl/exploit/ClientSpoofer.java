package wtf.demise.features.modules.impl.exploit;

import io.netty.buffer.ByteBuf;
import io.netty.buffer.Unpooled;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.C17PacketCustomPayload;
import wtf.demise.events.annotations.EventTarget;
import wtf.demise.events.impl.packet.PacketEvent;
import wtf.demise.features.modules.Module;
import wtf.demise.features.modules.ModuleInfo;
import wtf.demise.features.values.impl.ModeValue;
import wtf.demise.features.values.impl.TextValue;

@ModuleInfo(name = "ClientSpoofer", description = "Spoofs your client's serverside name.")
public class ClientSpoofer extends Module {
    private final ModeValue mode = new ModeValue("Mode", new String[]{"Lunar", "Feather", "Custom"}, "Lunar", this);
    private final TextValue customName = new TextValue("Custom name", "A client", this, () -> mode.is("Custom"));

    @EventTarget
    public void onPacket(PacketEvent packetEvent) {
        if (packetEvent.getPacket() instanceof C17PacketCustomPayload packet) {

            String data = switch (mode.get()) {
                case "Lunar" -> "lunarclient:v2.14.5-2411";
                case "Feather" -> "Feather Forge";
                case "Custom" -> customName.get();
                default -> "";
            };

            ByteBuf byteBuf = Unpooled.wrappedBuffer(data.getBytes());
            PacketBuffer buffer = new PacketBuffer(Unpooled.wrappedBuffer(byteBuf));

            packet.setData(buffer);
        }
    }
}
